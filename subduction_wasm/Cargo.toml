[package]
name = "subduction_wasm"
version = "0.4.0"
description = "Wasm/JavaScript bindings for Subduction (browser and Node.js)"
categories = ["web-programming"]
keywords = ["subduction", "websocket"]
readme = "./README.md"
exclude = ["e2e/server/pkg"]
publish = false

authors.workspace = true
edition.workspace = true
license.workspace = true
repository.workspace = true
rust-version.workspace = true

[lib]
crate-type = ["cdylib", "rlib"]

[dependencies]
async-channel = { workspace = true }
async-lock = { workspace = true }
base58 = { workspace = true }
ed25519-dalek = { workspace = true }
console_error_panic_hook = { workspace = true, optional = true }
from_js_ref = { workspace = true }
futures = { workspace = true }
future_form = { workspace = true }
futures-util = { workspace = true }
getrandom = { workspace = true, features = ["js"] }
js-sys = { workspace = true }
rand = { workspace = true }
sedimentree_core = { workspace = true }
sedimentree_wasm = { workspace = true }
subduction_core = { workspace = true }
subduction_crypto = { workspace = true }
thiserror = { workspace = true }
tracing = { workspace = true }
wasm-bindgen = { workspace = true }
wasm-bindgen-futures = { workspace = true }
wasm_refgen = { workspace = true }

[dependencies.web-sys]
version = "0.3.81"
default-features = false
features = [
  "BinaryType",
  "Crypto",
  "CryptoKey",
  "DomException",
  "DomStringList",
  "IdbDatabase",
  "IdbFactory",
  "IdbObjectStore",
  "IdbOpenDbRequest",
  "IdbRequest",
  "IdbTransaction",
  "IdbTransactionMode",
  "IdbVersionChangeEvent",
  "MessageEvent",
  "ServiceWorkerGlobalScope",
  "SubtleCrypto",
  "Url",
  "WebSocket",
  "Window"
]

[target.'cfg(target_family = "wasm")'.dependencies]
getrandom_03 = { package = "getrandom", version = "0.3", features = ["wasm_js"] }

[dev-dependencies]
wasm-bindgen-test = "0.2"

[features]
default = []
# Enable for better panic messages in dev builds (adds ~30KB due to std)
console_error_panic_hook = ["dep:console_error_panic_hook"]
# IndexedDB storage backend
idb = ["sedimentree_wasm/idb"]
std = [
  "async-channel/std",
  "async-lock/std",
  "futures/std",
  "futures-util/std",
  "js-sys/std",
  "rand/std",
  "sedimentree_core/std",
  "sedimentree_wasm/std",
  "subduction_core/std",
  "thiserror/std",
  "wasm-bindgen/std",
  "wasm-bindgen-futures/std"
]

[lints]
workspace = true
