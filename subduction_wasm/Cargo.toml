[package]
name = "subduction_wasm"
version = "0.1.0"
description = "Wasm bindings for Sedimentree Sync"
categories = ["web-programming"]
keywords = ["subduction", "websocket"]
readme = "./README.md"

authors.workspace = true
edition.workspace = true
license.workspace = true
repository.workspace = true
rust-version.workspace = true

[lib]
crate-type = ["cdylib", "rlib"]

[dependencies]
async-channel = { workspace = true }
async-lock = { workspace = true }
base58 = { workspace = true }
ciborium = { workspace = true }
ciborium-io = { workspace = true }
build_info = { path = "../build_info" }
console_error_panic_hook = { workspace = true, optional = true }
from_js_ref = { workspace = true }
futures = { workspace = true }
futures_kind = { workspace = true }
futures-util = { workspace = true }
getrandom = { workspace = true, features = ["wasm_js"] }
js-sys = { workspace = true }
rand = { workspace = true }
sedimentree_core = { path = "../sedimentree_core", default-features = false, features = ["serde"] }
subduction_core = { path = "../subduction_core", default-features = false, features = ["getrandom", "serde"] }
serde = { workspace = true }
thiserror = { workspace = true }
tracing = { workspace = true }
wasm-bindgen = { workspace = true }
wasm-bindgen-futures = { workspace = true }
wasm_refgen = { workspace = true }

[dependencies.web-sys]
version = "0.3.81"
default-features = false
features = [
  "BinaryType",
  "DomException",
  "MessageEvent",
  "ServiceWorkerGlobalScope",
  "Url",
  "WebSocket",
  "Window"
]

[dev-dependencies]
wasm-bindgen-test = "0.2"

[features]
default = []
# Enable for better panic messages in dev builds (adds ~30KB due to std)
console_error_panic_hook = ["dep:console_error_panic_hook"]
# IndexedDB storage backend
idb = [
  "web-sys/DomStringList",
  "web-sys/IdbCursorWithValue",
  "web-sys/IdbDatabase",
  "web-sys/IdbFactory",
  "web-sys/IdbIndex",
  "web-sys/IdbKeyRange",
  "web-sys/IdbObjectStore",
  "web-sys/IdbObjectStoreParameters",
  "web-sys/IdbOpenDbRequest",
  "web-sys/IdbTransaction",
  "web-sys/IdbTransactionMode",
  "web-sys/IdbVersionChangeEvent"
]
std = [
  "async-channel/std",
  "async-lock/std",
  "ciborium-io/std",
  "futures/std",
  "futures-util/std",
  "js-sys/std",
  "rand/std",
  "sedimentree_core/std",
  "subduction_core/std",
  "serde/std",
  "thiserror/std",
  "wasm-bindgen/std",
  "wasm-bindgen-futures/std"
]

[lints]
workspace = true
